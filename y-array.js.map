{"version":3,"sources":["../yjs/node_modules/browser-pack/_prelude.js","src/Array.js","y-array.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","_classCallCheck","instance","Constructor","TypeError","extend","Y","YArray","os","_model","_content","_this","this","eventHandler","utils","EventHandler","op","struct","pos","left","findIndex","c","compareIds","id","values","hasOwnProperty","splice","type","opContent","Promise","resolve","requestTransaction","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","delegateYield","getType","t0","stop","contents","content","map","val","apply","concat","callEventListeners","object","index","inDeletionRange","delLength","target","_values","_createClass","key","value","destroy","_this2","undefined","oid","_callee2","_context2","x","insert","Array","mostLeft","ops","newTypes","prevId","typeDefinition","origin","parent","isTypeDefinition","push","getNextOpId","typeid","awaitAndPrematurelyCall","_callee3","mostRight","ml","j","_context3","getInsertionCleanEnd","right","getOperation","t1","start","createType","awaitOps","applyCreatedOperations","dels","targetId","_callee4","_context4","addEventListener","removeEventListener","_changed","transaction","_context5","deleted","getInsertion","abrupt","receivedOp","get","CustomType","name","class","initType","YArrayInitializer","model","_context6","Struct","List","forEach","defineProperties","props","descriptor","enumerable","configurable","writable","Object","defineProperty","protoProps","staticProps","prototype"],"mappings":"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","file":"y-array.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\n'use strict'\n\nfunction extend (Y) {\n  class YArray {\n    constructor (os, _model, _content) {\n      this.os = os\n      this._model = _model\n      // Array of all the neccessary content\n      this._content = _content\n      this.eventHandler = new Y.utils.EventHandler((op) => {\n        if (op.struct === 'Insert') {\n          let pos\n          // we check op.left only!,\n          // because op.right might not be defined when this is called\n          if (op.left === null) {\n            pos = 0\n          } else {\n            pos = 1 + this._content.findIndex(function (c) {\n              return Y.utils.compareIds(c.id, op.left)\n            })\n            if (pos <= 0) {\n              throw new Error('Unexpected operation!')\n            }\n          }\n          var values\n          var length\n          if (op.hasOwnProperty('opContent')) {\n            this._content.splice(pos, 0, {\n              id: op.id,\n              type: op.opContent\n            })\n            let opContent = op.opContent\n            length = 1\n            values = () => {\n              return new Promise((resolve) => {\n                this.os.requestTransaction(function *() {\n                  var type = yield* this.getType(opContent)\n                  resolve([type])\n                })\n              })\n            }\n          } else {\n            var contents = op.content.map(function (c, i) {\n              return {\n                id: [op.id[0], op.id[1] + i],\n                val: c\n              }\n            })\n            // insert value in _content\n            this._content.splice.apply(this._content, [pos, 0].concat(contents))\n            values = op.content\n            length = op.content.length\n          }\n          this.eventHandler.callEventListeners({\n            type: 'insert',\n            object: this,\n            index: pos,\n            values: values,\n            // valueId: valueId, // TODO: does this still work as expected?\n            length: length\n          })\n        } else if (op.struct === 'Delete') {\n          var i = 0 // current position in _content\n          for (; i < this._content.length && op.length > 0; i++) {\n            var c = this._content[i]\n            if (Y.utils.inDeletionRange(op, c.id)) {\n              // is in deletion range!\n              var delLength\n              // check how many character to delete in one flush\n              for (delLength = 1;\n                    delLength < op.length && i + delLength < this._content.length && Y.utils.inDeletionRange(op, this._content[i + delLength].id);\n                    delLength++) {}\n              // last operation thas will be deleted\n              c = this._content[i + delLength - 1]\n              // update delete operation\n              op.length -= c.id[1] - op.target[1] + 1\n              op.target = [c.id[0], c.id[1] + 1]\n              // apply deletion & find send event\n              let content = this._content.splice(i, delLength)\n              // TODO: how about return types\n              let values = content.map(function (c) { return c.val })\n              this.eventHandler.callEventListeners({\n                type: 'delete',\n                object: this,\n                index: i,\n                values: values,\n                _content: content,\n                length: delLength\n              })\n              // with the fresh delete op, we can continue\n              // note: we don't have to increment i, because the i-th content was deleted\n              // but on the other had, the (i+delLength)-th was not in deletion range\n              // So we don't do i--\n            }\n          }\n        } else {\n          throw new Error('Unexpected struct!')\n        }\n      })\n    }\n    _destroy () {\n      this.eventHandler.destroy()\n      this.eventHandler = null\n      this._content = null\n      this._model = null\n      this.os = null\n    }\n    get length () {\n      return this._content.length\n    }\n    get (pos) {\n      if (pos == null || typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos >= this._content.length) {\n        return undefined\n      }\n      if (this._content[pos].type == null) {\n        return this._content[pos].val\n      } else {\n        var oid = this._content[pos].type\n        return new Promise((resolve) => {\n          this.os.requestTransaction(function *() {\n            var type = yield* this.getType(oid)\n            resolve(type)\n          })\n        })\n      }\n    }\n    // only returns primitive values\n    toArray () {\n      return this._content.map(function (x, i) {\n        return x.val\n      })\n    }\n    push (contents) {\n      return this.insert(this._content.length, contents)\n    }\n    insert (pos, contents) {\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (!(contents instanceof Array)) {\n        throw new Error('contents must be an Array of objects!')\n      }\n      if (contents.length === 0) {\n        return\n      }\n      if (pos > this._content.length || pos < 0) {\n        throw new Error('This position exceeds the range of the array!')\n      }\n      var mostLeft = pos === 0 ? null : this._content[pos - 1].id\n\n      var ops = []\n      var newTypes = []\n      var prevId = mostLeft\n      for (var i = 0; i < contents.length;) {\n        var op = {\n          left: prevId,\n          origin: prevId,\n          // right: mostRight,\n          // NOTE: I intentionally do not define right here, because it could be deleted\n          // at the time of inserting this operation (when we get the transaction),\n          // and would therefore not defined in this._content\n          parent: this._model,\n          struct: 'Insert'\n        }\n        var _content = []\n        var typeDefinition\n        while (i < contents.length) {\n          var val = contents[i++]\n          typeDefinition = Y.utils.isTypeDefinition(val)\n          if (!typeDefinition) {\n            _content.push(val)\n          } else if (_content.length > 0) {\n            i-- // come back again later\n            break\n          } else {\n            break\n          }\n        }\n        if (_content.length > 0) {\n          // content is defined\n          op.content = _content\n          op.id = this.os.getNextOpId(_content.length)\n        } else {\n          // otherwise its a type\n          var typeid = this.os.getNextOpId(1)\n          newTypes.push([typeDefinition, typeid])\n          op.opContent = typeid\n          op.id = this.os.getNextOpId(1)\n        }\n        ops.push(op)\n        prevId = op.id\n      }\n      var eventHandler = this.eventHandler\n      eventHandler.awaitAndPrematurelyCall(ops)\n      this.os.requestTransaction(function *() {\n        // now we can set the right reference.\n        var mostRight\n        if (mostLeft != null) {\n          var ml = yield* this.getInsertionCleanEnd(mostLeft)\n          mostRight = ml.right\n        } else {\n          mostRight = (yield* this.getOperation(ops[0].parent)).start\n        }\n        for (var i = 0; i < newTypes.length; i++) {\n          yield* this.createType.apply(this, newTypes[i])\n        }\n        for (var j = 0; j < ops.length; j++) {\n          var op = ops[j]\n          op.right = mostRight\n        }\n        yield* eventHandler.awaitOps(this, this.applyCreatedOperations, [ops])\n      })\n    }\n    delete (pos, length) {\n      if (length == null) { length = 1 }\n      if (typeof length !== 'number') {\n        throw new Error('length must be a number!')\n      }\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos + length > this._content.length || pos < 0 || length < 0) {\n        throw new Error('The deletion range exceeds the range of the array!')\n      }\n      if (length === 0) {\n        return\n      }\n      var eventHandler = this.eventHandler\n      var dels = []\n      for (var i = 0; i < length; i = i + delLength) {\n        var targetId = this._content[pos + i].id\n        var delLength\n        // how many insertions can we delete in one deletion?\n        for (delLength = 1; i + delLength < length; delLength++) {\n          if (!Y.utils.compareIds(this._content[pos + i + delLength].id, [targetId[0], targetId[1] + delLength])) {\n            break\n          }\n        }\n        dels.push({\n          target: targetId,\n          struct: 'Delete',\n          length: delLength\n        })\n      }\n      eventHandler.awaitAndPrematurelyCall(dels)\n      this.os.requestTransaction(function *() {\n        yield* eventHandler.awaitOps(this, this.applyCreatedOperations, [dels])\n      })\n    }\n    observe (f) {\n      this.eventHandler.addEventListener(f)\n    }\n    unobserve (f) {\n      this.eventHandler.removeEventListener(f)\n    }\n    * _changed (transaction, op) {\n      if (!op.deleted) {\n        if (op.struct === 'Insert') {\n          var l = op.left\n          var left\n          while (l != null) {\n            left = yield* transaction.getInsertion(l)\n            if (!left.deleted) {\n              break\n            }\n            l = left.left\n          }\n          op.left = l\n        }\n        this.eventHandler.receivedOp(op)\n      }\n    }\n  }\n\n  Y.extend('Array', new Y.utils.CustomType({\n    name: 'Array',\n    class: YArray,\n    struct: 'List',\n    initType: function * YArrayInitializer (os, model) {\n      var _content = []\n      yield* Y.Struct.List.map.call(this, model, function (op) {\n        if (op.hasOwnProperty('opContent')) {\n          _content.push({\n            id: op.id,\n            type: op.opContent\n          })\n        } else {\n          op.content.forEach(function (c, i) {\n            _content.push({\n              id: [op.id[0], op.id[1] + i],\n              val: op.content[i]\n            })\n          })\n        }\n      })\n      return new YArray(os, model.id, _content)\n    }\n  }))\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n",null],"sourceRoot":"/source/"}