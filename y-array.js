/**
 * yjs - A framework for real-time p2p shared editing on any data
 * @version v12.1.7
 * @link http://y-js.org
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.yArray=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n||e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=function(t){function n(t,i,a){r(this,n);var s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.os=t,s._model=i,s._content=a,s.eventHandler=new e.utils.EventHandler(function(t){if("Insert"===t.struct){if(s._content.some(function(n){return e.utils.compareIds(n.id,t.id)}))return;var n=void 0;if(null===t.left)n=0;else if((n=1+s._content.findIndex(function(n){return e.utils.compareIds(n.id,t.left)}))<=0)throw new Error("Unexpected operation!");var r,o;if(t.hasOwnProperty("opContent"))s._content.splice(n,0,{id:t.id,type:t.opContent}),o=1,r=[s.os.getType(t.opContent)];else{var i=t.content.map(function(e,n){return{id:[t.id[0],t.id[1]+n],val:e}});i.length<3e4?s._content.splice.apply(s._content,[n,0].concat(i)):s._content=s._content.slice(0,n).concat(i).concat(s._content.slice(n)),r=t.content,o=t.content.length}s.eventHandler.callEventListeners({type:"insert",object:s,index:n,values:r,length:o})}else{if("Delete"!==t.struct)throw new Error("Unexpected struct!");for(var a=0;a<s._content.length&&t.length>0;a++){var u=s._content[a];if(e.utils.inDeletionRange(t,u.id)){var l;for(l=1;l<t.length&&a+l<s._content.length&&e.utils.inDeletionRange(t,s._content[a+l].id);l++);u=s._content[a+l-1],t.length-=u.id[1]-t.target[1]+1,t.target=[u.id[0],u.id[1]+1];var c=s._content.splice(a,l),f=c.map(function(e){return null!=e.val?e.val:s.os.getType(e.type)});s.eventHandler.callEventListeners({type:"delete",object:s,index:a,values:f,_content:c,length:l})}}}}),s}return i(n,t),s(n,[{key:"_destroy",value:function(){this.eventHandler.destroy(),this.eventHandler=null,this._content=null,this._model=null,this.os=null}},{key:"get",value:function(e){if(null==e||"number"!=typeof e)throw new Error("pos must be a number!");if(!(e>=this._content.length))return null==this._content[e].type?this._content[e].val:this.os.getType(this._content[e].type)}},{key:"toArray",value:function(){var e=this;return this._content.map(function(t,n){return null!=t.type?e.os.getType(t.type):t.val})}},{key:"push",value:function(e){return this.insert(this._content.length,e)}},{key:"insert",value:function(t,n){if("number"!=typeof t)throw new Error("pos must be a number!");if(!(n instanceof Array))throw new Error("contents must be an Array of objects!");if(0!==n.length){if(t>this._content.length||t<0)throw new Error("This position exceeds the range of the array!");for(var r=0===t?null:this._content[t-1].id,o=[],i=r,a=0;a<n.length;){for(var s,u={left:i,origin:i,parent:this._model,struct:"Insert"},l=[];a<n.length;){var c=n[a++];if(s=e.utils.isTypeDefinition(c)){if(l.length>0){a--;break}break}l.push(c)}if(l.length>0)u.content=l,u.id=this.os.getNextOpId(l.length);else{var f=this.os.getNextOpId(1);this.os.createType(s,f),u.opContent=f,u.id=this.os.getNextOpId(1)}o.push(u),i=u.id}var p=this.eventHandler;this.os.requestTransaction(regeneratorRuntime.mark(function e(){var t,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r){e.next=6;break}return e.delegateYield(this.getInsertionCleanEnd(r),"t0",2);case 2:n=e.t0,t=n.right,e.next=8;break;case 6:return e.delegateYield(this.getOperation(o[0].parent),"t1",7);case 7:t=e.t1.start;case 8:for(i=0;i<o.length;i++)a=o[i],a.right=t;return e.delegateYield(p.awaitOps(this,this.applyCreatedOperations,[o]),"t2",10);case 10:case"end":return e.stop()}},e,this)})),p.awaitAndPrematurelyCall(o)}}},{key:"delete",value:function(t,n){if(null==n&&(n=1),"number"!=typeof n)throw new Error("length must be a number!");if("number"!=typeof t)throw new Error("pos must be a number!");if(t+n>this._content.length||t<0||n<0)throw new Error("The deletion range exceeds the range of the array!");if(0!==n){for(var r=this.eventHandler,o=[],i=0;i<n;i+=a){var a,s=this._content[t+i].id;for(a=1;i+a<n&&e.utils.compareIds(this._content[t+i+a].id,[s[0],s[1]+a]);a++);o.push({target:s,struct:"Delete",length:a})}this.os.requestTransaction(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(r.awaitOps(this,this.applyCreatedOperations,[o]),"t0",1);case 1:case"end":return e.stop()}},e,this)})),r.awaitAndPrematurelyCall(o)}}},{key:"observe",value:function(e){this.eventHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this.eventHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.deleted){e.next=15;break}if("Insert"!==n.struct){e.next=14;break}r=n.left;case 3:if(null==r){e.next=11;break}return e.delegateYield(t.getInsertion(r),"t0",5);case 5:if(o=e.t0,o.deleted){e.next=8;break}return e.abrupt("break",11);case 8:r=o.left,e.next=3;break;case 11:if(n.left=r,null==n.opContent){e.next=14;break}return e.delegateYield(t.store.initType.call(t,n.opContent),"t1",14);case 14:this.eventHandler.receivedOp(n);case 15:case"end":return e.stop()}},e,this)})},{key:"length",get:function(){return this._content.length}}]),n}(e.utils.CustomType);e.extend("Array",new e.utils.CustomTypeDefinition({name:"Array",class:t,struct:"List",initType:regeneratorRuntime.mark(function n(r,o){var i,a,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=[],a=[],n.delegateYield(e.Struct.List.map.call(this,o,function(e){e.hasOwnProperty("opContent")?(i.push({id:e.id,type:e.opContent}),a.push(e.opContent)):e.content.forEach(function(t,n){i.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",3);case 3:s=0;case 4:if(!(s<a.length)){n.next=9;break}return n.delegateYield(this.store.initType.call(this,a[s]),"t1",6);case 6:s++,n.next=4;break;case 9:return n.abrupt("return",new t(r,o.id,i));case 10:case"end":return n.stop()}},n,this)}),createType:function(e,n){return new t(e,n.id,[])}}))}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=a,"undefined"!=typeof Y&&a(Y)},{}]},{},[1])(1)});
//# sourceMappingURL=y-array.js.map
